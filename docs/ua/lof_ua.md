# Опис роботи скрипта

Цей скрипт виконує **вибірку на основі аномалій** за допомогою методу **Local Outlier Factor (LOF)** для виявлення відхилень у наборі даних. LOF визначає аномалії на основі локальної щільності записів, порівнюючи кожен запис із сусідніми.**ВАЖЛИВО** Для забезпечення швидкої роботи усіх модулей програми, для данного алгоритму введено обмеження, щодо використання на датасетах, що містять більше 1 000 000 записів.

## Як працює Local Outlier Factor:

### Основи алгоритму Local Outlier Factor:
- **Local Outlier Factor (LOF)** — це метод для виявлення аномалій, який оцінює, наскільки сильно кожен запис відрізняється від своїх сусідів у багатовимірному просторі.
- LOF використовує локальну щільність даних для визначення аномальних записів. Записи, що знаходяться в менш щільних областях простору, вважаються аномаліями.
- **Аномалії** визначаються як ті записи, що мають низьку щільність у порівнянні з їхніми найближчими сусідами, тобто вони "ізольовані" у просторі.

### Як це працює:

### Підготовка даних:
- Створюються копії оригінального та підготовленого наборів даних, щоб уникнути змін у вихідних даних.
- До набору даних додаються стовпці для зберігання оцінок аномалій та міток.

### Створення та навчання моделі Local Outlier Factor:
- Модель **Local Outlier Factor (LOF)** створюється з використанням стандартних гіперпараметрів. Алгоритм оцінює, наскільки кожен запис відрізняється від своїх сусідів.
- Модель тренується на підготовленому наборі даних.

### Оцінка аномалій:
- Після тренування моделі обчислюються **оцінки аномалій** для кожного запису. Записи з найнижчими оцінками вважаються найбільш аномальними.
- Додаються стовпці з оцінками та мітками аномалій до обох наборів даних (оригінального та підготовленого).

### Відбір вибірки:
- Вибираються найбільш аномальні зразки на основі їхньої оцінки аномалій. Якщо кількість аномалій перевищує розмір вибірки, відбір здійснюється випадковим чином.

### Формування вибірки:
- Найбільш аномальні записи додаються у фінальну вибірку, і ці записи позначаються у стовпці `is_sample`.
- Якщо кількість виявлених аномалій менша, ніж запитаний розмір вибірки, виводиться попередження.

### Звіт про виконання:
- Формується підсумковий звіт про виконану вибірку, який включає розмір популяції, кількість виявлених аномалій, дату та час виконання, використані гіперпараметри моделі, та розмір вибірки.

---

## Важливі моменти:

- **Аналіз локальної щільності**: LOF порівнює щільність кожного запису з його найближчими сусідами, що дозволяє виявляти ізольовані записи як аномалії.
- **Модель LOF**: Модель використовує локальні відстані між записами для оцінки аномалій, що робить її ефективною для виявлення локальних відхилень у даних.
- **Відтворюваність**: Якщо використовується випадкове зерно, відбір аномалій може бути відтворений з однаковими результатами.

---

## Можливі відхилення:

- **Мала кількість аномалій**: Якщо у популяції мало аномалій, вибірка може бути меншою, ніж запитувана кількість.
- **Налаштування гіперпараметрів**: Використання стандартних гіперпараметрів може не завжди дати оптимальні результати для конкретних наборів даних.

---

## На завершення:

- **Local Outlier Factor (LOF)** є ефективним методом для виявлення локальних аномалій, використовуючи щільність сусідніх записів. Цей скрипт дозволяє проводити вибірку на основі цих аномалій і формувати фінальний набір для подальшого аналізу.
