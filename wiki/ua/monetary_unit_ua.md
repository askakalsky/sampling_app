# Опис роботи скрипта

Цей скрипт призначений для виконання вибірки з набору даних, де кожен запис має певну грошову цінність. Вибірка виконується так, щоб більш дорогі записи мали більше шансів бути обраними. Це називається **Monetary Unit Sampling** — метод вибірки, що заснований на грошових одиницях.

## Як це працює:

### Підготовка даних:
- Спочатку створюється копія вихідного набору даних, щоб вихідні дані залишалися незмінними.
- Кожному запису присвоюється унікальний ідентифікатор для відстеження обраних записів.
- Усі записи позначаються як не вибрані у вибірку, що потрібно для подальшої позначки обраних записів.

### Фільтрація:
- Якщо вибірка має бути заснована лише на значних за вартістю записах, задається поріг. Записи з нижчою вартістю виключаються з розгляду. Це дозволяє зосередитися на записах, що відповідають певному рівню значущості.

### Розподіл на групи (якщо застосовується):
- Якщо необхідно розділити дані на групи за якоюсь ознакою (наприклад, категоріями або типами), дані поділяються на групи. Це корисно, коли потрібно забезпечити репрезентативність кожної групи у вибірці.

### Визначення, скільки записів вибрати з кожної групи:
- Для кожної групи розраховується, скільки записів має бути вибрано. Цей розрахунок заснований на пропорції групи відносно загальної кількості записів у даних. Наприклад, якщо одна група складає 30% усіх даних, то приблизно 30% вибірки має припадати на цю групу.
- Після розрахунку відбувається округлення. Це може викликати невеликі відхилення від ідеальних пропорцій, оскільки вибірка може складатися тільки з цілих записів.

### Коригування розміру вибірки:
- Якщо після округлення загальна кількість обраних записів не збігається із запитуваним розміром вибірки, скрипт коригує це число, додаючи або зменшуючи кількість записів у найбільших групах. Це робиться для того, щоб підсумковий розмір вибірки точно відповідав тому, що було задано.

### Відбір записів усередині кожної групи:
- Для кожної групи виконується відбір записів на підставі їх вартості. Чим більша вартість запису, тим більше ймовірність, що він потрапить у вибірку.
- Вибірка здійснюється таким чином: вартість усіх записів підсумовується, і для вибірки генеруються випадкові точки в межах цієї суми. Ті записи, чия накопичена вартість "перекриває" ці точки, потрапляють у вибірку.
- Якщо виникають дубльовані вибори (наприклад, якщо випадкові точки потрапляють на один і той самий запис), генеруються нові точки, поки не буде досягнутий необхідний розмір вибірки.

### Формування фінальної вибірки:
- Записи, вибрані з кожної групи, збираються в одну підсумкову вибірку.
- У вихідних даних позначаються записи, що були вибрані, щоб можна було легко побачити, які саме записи потрапили у вибірку.

### Звіт про виконання:
- Наприкінці формується опис процесу вибірки, який включає загальну інформацію про популяцію, параметри вибірки та результати. Це опис містить деталі про кількість записів у вибірці, використані параметри, а також інформацію про те, коли та як було виконано вибірку.

---

## Важливі моменти:

- **Пропорційність вибірки**: Скрипт намагається зберегти пропорції між групами, щоб кожна група була представлена у вибірці відповідно до своєї частки у даних.
- **Урахування вартості записів**: Усередині кожної групи відбір записів залежить від їхньої вартості. Це означає, що дорожчі записи мають більше шансів бути вибраними.
- **Коригування після округлення**: Після визначення кількості записів для кожної групи можливе коригування, щоб підсумковий розмір вибірки точно відповідав запитуваному.

---

## Коли пропорції можуть відхилятися:

- **Округлення**: Через округлення кількість записів для кожної групи може трохи відрізнятися від ідеально пропорційного розподілу.
- **Коригування**: Якщо після округлення загальна сума записів менша або більша від запитуваної, відбувається коригування, яке може трохи змінити пропорції.
- **Фільтрація**: Якщо застосовується фільтрація за вартістю, групи з великою кількістю низьковартісних записів можуть бути недопредставлені у вибірці, оскільки вони частково виключаються.
- **Малі групи**: Якщо група занадто мала, її записи можуть бути або повністю включені до вибірки, або виключені, що також впливає на дотримання пропорцій.

---

## На завершення:

- Цей скрипт допомагає створювати вибірку, яка відображає розподіл грошових значень у вихідних даних, а також може враховувати різні категорії або типи записів, якщо це необхідно.
