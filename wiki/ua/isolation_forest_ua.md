# Опис роботи скрипта

Цей скрипт виконує **вибірку на основі аномалій** за допомогою методу **Isolation Forest**, який застосовується для виявлення відхилень у наборі даних. Isolation Forest використовує дерев'яну структуру для ізоляції аномальних точок, що дозволяє швидко та ефективно ідентифікувати "аномалії".

## Як працює Isolation Forest:

### Основи алгоритму Isolation Forest:
- **Isolation Forest** — це метод, який працює за принципом ізоляції точок у багатовимірному просторі. Метою алгоритму є ізоляція кожної точки (запису) від решти даних.
- Кожен запис ізолюється шляхом делення даних на підмножини за допомогою дерев ізоляції, причому аномальні записи ізолюються швидше за нормальні, оскільки для їх ізоляції потрібно менше розрізів.
- **Аномалії** визначаються як ті записи, які ізолюються швидше, тобто на більш ранніх етапах побудови дерева.

### Як це працює:

### Підготовка даних:
- Створюються копії оригінального та підготовленого наборів даних, щоб уникнути змін у вихідних даних.
- До набору даних додаються стовпці для зберігання оцінок аномалій та міток.

### Створення та навчання моделі Isolation Forest:
- Модель **Isolation Forest** створюється з використанням стандартних гіперпараметрів і випадкового зерна для забезпечення відтворюваності результатів.
- **Isolation Forest** будує кілька дерев ізоляції, де кожне дерево ізолює окремі точки шляхом випадкового поділу ознак і значень.

### Оцінка аномалій:
- Після тренування моделі обчислюються **оцінки аномалій** для кожного запису. Чим менше потрібно поділів для ізоляції запису, тим більш аномальним він вважається.
- Додаються стовпці з оцінками та мітками аномалій до обох наборів даних (оригінального та підготовленого).

### Відбір вибірки:
- Обидва набори даних сортуються за оцінками аномалій, починаючи з найнижчих значень.
- Вибираються найбільш аномальні зразки для вибірки на основі запитаного розміру вибірки.

### Формування вибірки:
- Найбільш аномальні записи додаються у фінальну вибірку, і ці записи позначаються у стовпці `is_sample`.

### Звіт про виконання:
- Формується підсумковий звіт про виконану вибірку, який включає розмір популяції, кількість виявлених аномалій, дату та час виконання, гіперпараметри моделі, та розмір вибірки.

---

## Важливі моменти:

- **Алгоритм ізоляції**: Записи, які ізолюються швидше, розглядаються як більш аномальні, і саме вони вибираються для подальшого аналізу.
- **Модель Isolation Forest**: Цей метод побудований на використанні дерев ізоляції та виявляє аномалії на основі кількості розрізів, необхідних для ізоляції точки.
- **Відтворюваність**: Якщо використовується випадкове зерно, модель та вибірка можуть бути відтворені з тими самими результатами.

---

## Можливі відхилення:

- **Мала кількість аномалій**: Якщо популяція має мало аномалій, вибірка може містити записи, які не є значно аномальними.
- **Налаштування гіперпараметрів**: Використання стандартних гіперпараметрів може не дати оптимальних результатів для конкретних наборів даних.

---

## На завершення:

- **Isolation Forest** — це ефективний метод для виявлення аномалій, який використовує дерев'яну структуру для ізоляції записів. Цей скрипт дозволяє проводити вибірку на основі цих аномалій і формувати фінальний набір для подальшого аналізу.
